language: php

php:
  - 5.3

mysql:
  database: wetkit_db
  username: root
  encoding: utf8

before_script: 
 - mysql -e 'create database wetkit_db;'
 - pyrus channel-discover pear.drush.org
 - pyrus install drush/drush
 - phpenv rehash
 - drush make distro.make ../github_wet_distro
 - cd ../github_wet_distro
 - sudo chmod -R 777 sites/all/modules
 - sudo drush si wetkit wetkit_theme_form.theme=wetkit_adaptivetheme --sites-subdir=default --db-url=mysql://root:@localhost/wetkit_db --account-name=admin --account-pass=WetKit@2012 --site-mail=admin@example.com --site-name="Web Experience Toolkit" --yes
 - drush cc all --yes
 - "export PHANTOMJS_EXECUTABLE='phantomjs --local-to-remote-url-access=yes --ignore-ssl-errors=yes'"
 - "export DISPLAY=:99.0"
 - "sh -e /etc/init.d/xvfb start"
 - sleep 3 # give xvfb some time to start
 - drush runserver 8080 &
 - sleep 3 # give Web server some time to bind to sockets, etc
 - cd ..
 - git clone git://github.com/n1k0/casperjs.git
 - cd casperjs
 - git checkout tags/0.6.10
 - cd ./bin
 
script:
 - ls -al
 - "DISPLAY=:99.0 ./casperjs test ../../github_wet_distro/test/casperjs/"