(function(){var a=tinymce.each;tinymce.PluginManager.requireLangPack("wetkitcleanup");tinymce.create("tinymce.plugins.WAS_Cleanup",{init:function(b,c){var d=this;d.url=c;d.editor=b;d.sbCtrl=null;d.acronymRunCount=0},getInfo:function(){return{longname:"WAS Tools and Cleanup Operations",author:"Mike Block Consulting Inc.",authorurl:"http://www.bistromatics.com",infourl:"http://www.bistromatics.com/?wetkitcleanup",version:"0.1"}},createControl:function(g,b){var e=this,f,d=e.editor;if(g=="wetkitcleanup"){f=b.createSplitButton(g,{title:d.getLang("wetkitcleanup.title"),onclick:e._aboutPlugin,image:e.url+"/img/wetkitcleanup.png"});f.onRenderMenu.add(function(p,k){var o="en",r="fr",l=null,i=null,n=false;var q=d.id.match(/-(en|fr)-/);if(q&&q.length>1){o=q[1];if(o=="fr"){r="en";i=d.id}else{l=d.id}var j=d.id.replace("-"+o+"-","-"+r+"-");if(tinyMCE.get(j)){if(o=="fr"){l=j}else{i=j}n=true}}var h=k.addMenu({title:d.getLang("wetkitcleanup.convert_titles"),onclick:function(){return false},onmouseover:function(){alert(1)}});h.add({title:d.getLang("wetkitcleanup.demote_titles"),onclick:function(){e._dropHeadingLevels()}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.promote_titles"),onclick:function(){e._liftHeadingLevels()}}).setDisabled(0);e.hideHeading=h.add({title:d.getLang("wetkitcleanup.hide_heading_from_index"),onclick:function(){e._hideHeading(true)}}).setDisabled(0);e.showHeading=h.add({title:d.getLang("wetkitcleanup.show_heading_in_index"),onclick:function(){e._hideHeading(false)}}).setDisabled(0);h=k.addMenu({title:d.getLang("wetkitcleanup.convert_tables"),onclick:function(){return false}});e.convertThisTable=h.add({title:d.getLang("wetkitcleanup.convert_table_text"),onclick:function(){e._tableToText()}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.convert_tables_text"),onclick:function(){e._stripAllTables()}}).setDisabled(0);h=k.addMenu({title:d.getLang("wetkitcleanup.table_headers"),onclick:function(){return false}});h.add({title:d.getLang("wetkitcleanup.first_row_headers"),onclick:function(){e._addTableHeaders(false)}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.thead_col_headers"),onclick:function(){e._addTableHeaders(true)}}).setDisabled(0);e.firstColumnHeadersThisTable=h.add({title:d.getLang("wetkitcleanup.first_col_row_headers_active_table"),onclick:function(){e._addTableRowHeaders(true)}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.first_col_row_headers"),onclick:function(){e._addTableRowHeaders(false)}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.add_header_ids"),onclick:function(){e._addTableCellIDHeaders(true)}}).setDisabled(0);h=k.addMenu({title:d.getLang("wetkitcleanup.change_selection_case"),onclick:function(){return false}});h.add({title:d.getLang("wetkitcleanup.uppercase"),onclick:function(){e._changeCaseIgnoreHTML("upper")}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.lowercase"),onclick:function(){e._changeCaseIgnoreHTML("lower")}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.sentence_case"),onclick:function(){e._changeCaseIgnoreHTML("sentence")}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.title_case"),onclick:function(){e._changeCaseIgnoreHTML("title")}}).setDisabled(0);h=k.addMenu({title:d.getLang("wetkitcleanup.process_acronyms"),onclick:function(){return false}});h.add({title:d.getLang("wetkitcleanup.process_acronyms_saved"),onclick:function(){e._findReplaceAcronyms(false)}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.process_acronyms_custom"),onclick:function(){e._findReplaceAcronyms(true)}}).setDisabled(0);h=k.addMenu({title:d.getLang("wetkitcleanup.set_language"),onclick:function(){return false}});h.add({title:d.getLang("wetkitcleanup.set_language_en"),onclick:function(){e._setLanguage("en")}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.set_language_fr"),onclick:function(){e._setLanguage("fr")}}).setDisabled(0);h=k.addMenu({title:d.getLang("wetkitcleanup.extract_column"),onclick:function(){return false}});if(n){h.add({title:d.getLang("wetkitcleanup.split_content_ef"),onclick:function(){e._splitColumnContent(Array(l,i),Array(1,2))}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.split_content_fe"),onclick:function(){e._splitColumnContent(Array(l,i),Array(2,1))}}).setDisabled(0)}h.add({title:d.getLang("wetkitcleanup.extract_column_1"),onclick:function(){e._extractTableColumn(1)}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.extract_column_2"),onclick:function(){e._extractTableColumn(2)}}).setDisabled(0);k.add({title:d.getLang("wetkitcleanup.quick_fix_all"),onclick:function(){e._QuickFixAll()}}).setDisabled(0);h=k.addMenu({title:d.getLang("wetkitcleanup.other_cleanup"),onclick:function(){return false}});h.add({title:d.getLang("wetkitcleanup.remove_empty_blocks"),onclick:function(){e._removeEmptyBlocks()}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.remove_table_dimensions"),onclick:function(){e._tableStripWidthHeight(false)}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.remove_table_dimensions_active"),onclick:function(){e._tableStripWidthHeight(true)}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.convert_cell_alignments"),onclick:function(){e._tableConvertAlignToStyles()}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.right_align_data"),onclick:function(){e._tableDataAlign("right")}}).setDisabled(0);h.add({title:d.getLang("wetkitcleanup.join_number_groups"),onclick:function(){e._numberGroups()}}).setDisabled(0)});e.sbCtrl=f;return f}},_aboutPlugin:function(){var b=this;alert(b.editor.getLang("wetkitcleanup.description"))},_getMenuOptions:function(){var h=this,f=h.editor,e,g,j=f.getDoc(),c=f.getBody();h.firstColumnHeadersThisTable},_QuickFixAll:function(){var h=this,f=h.editor,e,g,k=f.getDoc(),c=f.getBody();h._removeEmptyBlocks();h._numberGroups();h._tableDataParas();h._tableDataAlign("right");h._tableConvertAlignToStyles();var j=c.innerHTML;j=j.replace(/<o:p>(&nbsp;|\s)*<\/o:p>/g,"");j=j.replace(/<\/?o\:[^>]*>/g,"");j=j.replace(/<st1:[^>]*>/g,"");j=j.replace(/<\?xml:[^>]*>/g,"");j=j.replace(/<\/?(?:st1|font|V:|o:p)[^>]*>/ig,"");j=j.replace(/<!\[if !mso\]>.*?<!\[endif\]>/ig,"");j=j.replace(/<!\[if !supportEmptyParas\]>.*?<!\[endif\]>/ig,"");j=j.replace(/<!--\[if supportFields\]>.*?<!\[endif\]-->/ig,"");j=j.replace(/<!\[if !supportLists\]>.*?<!\[endif\]>/ig,"<li>");j=j.replace(/<!\[if !supportMisalignedRows+\]>.*?<!\[endif\]>/ig,"");j=j.replace(/<v:shapetype .*?<\/v:shapetype>/ig,"");j=j.replace(/<v:shape .*?<\/v:shape>/ig,"");j=j.replace(/ v:shapes="[^"]+"/ig,"");j=j.replace(/<del [^>]+>.*?<\/del>/ig,"");j=j.replace(/<ins [^>]+>(.*?)<\/ins>/ig,"$1");j=j.replace(/<!--\[if[^>]+-->/ig,"");j=j.replace(/<!\[endif\]-->/ig,"");j=j.replace(/\s+class="mso[^"]+"/ig,"");j=j.replace(/margin:\s+[^;]+(\s+[^;]+)\s+[^;]+(\s+[^;]+);/ig,"margin: auto $1 auto $2;");j=j.replace(/%1e/g,"-");j=j.replace(/(<li(?:>|\s[^>]*>))(?:&nbsp;|\s)*(?:&middot;|o|&sect;|&bull;)(?:&nbsp;|\s)+/ig,"$1");j=j.replace(/<(p|h[1-6])(?:>|\s[^>]*>)(?:&nbsp;|\s|<br \/>|<\/?(?:em|strong|span|b|i)(?:>|\s[^>]*>))*<\/\1>/ig,"");j=j.replace(/(<td[^>]*>)\s*(<\/td>)/ig,"$1&nbsp;$2");j=j.replace(/(<(?:em|strong|b|i)>)\s*(<(?:p|h[1-6])[^>]*>)/ig,"$2$1");j=j.replace(/(<\/(?:p|h[1-6])>)\s*(<\/(?:em|strong|b|i)>)/ig,"$2$1");j=j.replace(/(<(?:p|h[1-6])[^>]*)\s+align="left"/ig,"$1");j=j.replace(/(<(?:p|h[1-6])[^>]*)\s+align="(right|center|justify)"/ig,'$1 style="text-align: $2"');j=j.replace(/(<(?:p|h[1-6])(?:>|\s[^>]*>))(&nbsp;|\s|<br[^>]*>)+/ig,"$1");j=j.replace(/(?:<(p|h[1-6])(?:>|\s[^>]*>))(&nbsp;|\s|<br[^>]*>)*<\/\1>/ig,"");j=j.replace(/(?:<(p|h[1-6])(?:>|\s[^>]*>))<span[^>]*>(&nbsp;|\s|<br[^>]*>)*<\/span><\/\1>/ig,"");j=j.replace(/&nbsp;(&nbsp;)+\s/ig," ");j=j.replace(/<(?:b|strong)>\s*(<p(?:>|\s[^>]*>))(.*?)(<\/p>)\s*<\/(?:b|strong)>/ig,"$1<strong>$2</strong></p>");j=j.replace(/<(strong|em)>(\s*)<\/\1>/ig,"$2");j=j.replace(/(<a[^>]*href=")file:[^"#]+/ig,"$1");j=j.replace(/(<a[^>]*)\sid="_(ftn|edn)ref(\d+)"/ig,"$1");j=j.replace(/(<a[^>]*)\sname="_(ftn|edn)ref(\d+)"/ig,"$1");j=j.replace(/(<a[^>]*\shref="[^"]*#_(ftn|edn)ref(\d+)")([^>]*)/ig,'$1 name="_$2$3" id="_$2$3"$4');j=j.replace(/(<a[^>]*\shref="[^"]*#_(ftn|edn)(\d+)")([^>]*)/ig,'$1 name="_$2ref$3" id="_$2ref$3"$4');j=j.replace(/(<\/a>)(\[(\d+)\])/ig,"$2$1");c.innerHTML=j},_removeEmptyBlocks:function(){var h=this,f=h.editor,e,g,k=f.getDoc(),c=f.getBody();var j=new RegExp("(<(h[1-6]|p)[^>]*>)(?:&nbsp;|s)*(</\\2>)","ig");c.innerHTML=c.innerHTML.replace(j,"")},_dropHeadingLevels:function(){var h=this,f=h.editor,e,g,k=f.getDoc(),c=f.getBody();for(var g=6;g>=1;g--){var j=new RegExp("(</*h)"+g,"ig");c.innerHTML=c.innerHTML.replace(j,"$1"+(g+1))}},_liftHeadingLevels:function(){var h=this,f=h.editor,e,g,k=f.getDoc(),c=f.getBody();for(var g=2;g<=6;g++){var j=new RegExp("(</*h)"+g,"ig");c.innerHTML=c.innerHTML.replace(j,"$1"+(g-1))}},_hideHeading:function(d){var c=this;var b=c.editor.selection.getNode();var e=c.editor.dom.getParent(b,"h1,h2,h3,h4,h5,h6");if(!e){alert(c.editor.getLang("wetkitcleanup.no_heading_selected"));return false}if(d){c.editor.dom.addClass(e,"noidxentry")}else{c.editor.dom.removeClass(e,"noidxentry")}},_setLanguage:function(f){var e=this,c=e.editor,d;if(!c.selection){return false}if(c.selection.getStart().tagName!=c.selection.getEnd().tagName){return false}var b=c.selection.getContent();b='<span lang="'+f+'">'+b+"</span>";c.selection.setContent(b)},_changeCaseIgnoreHTML:function(c){var l=this,e=l.editor,b;var g=Array();if(!e.selection){return false}if(e.selection.getStart().tagName!=e.selection.getEnd().tagName){alert(l.editor.getLang("wetkitcleanup.tool_title"));return false}var h=e.selection.getContent();h=l._convertExtended(h);var d=h.match(/(<.*?>)/ig);for(b=0;d&&d[b];b++){g[b]=d[b];h=h.replace(g[b],"%_%%"+b+"%%_%")}if(c=="upper"){h=h.toUpperCase()}else{if(c=="lower"){h=h.toLowerCase()}else{if(c=="sentence"){var k=h.split(".");h="";for(b=0;k[b];b++){var m=k[b].replace(/^([^a-zA-ZÀÁÂÃÄÅÇÈÉÊËÌÍÎÏÒÓÔÕÖÙÚÛÜÝàáâãäåçèéêëìíîïðñòóôõöùúûüýÿ]*).*/,"$1");k[b]=k[b].replace(/^[^a-zA-ZÀÁÂÃÄÅÇÈÉÊËÌÍÎÏÒÓÔÕÖÙÚÛÜÝàáâãäåçèéêëìíîïðñòóôõöùúûüýÿ]*(.*)/,"$1");h=h+m+k[b].substring(0,1).toUpperCase()+k[b].substring(1).toLowerCase()+(k[b+1]?".":"")}}else{if(c=="title"){var f=new RegExp("([^a-zA-Z0-9ÀÁÂÃÄÅÇÈÉÊËÌÍÎÏÒÓÔÕÖÙÚÛÜÝàáâãäåçèéêëìíîïðñòóôõöùúûüýÿ'`]|%_%%\d+%%_%)+");var j=h.split(f);for(b=0;j[b];b++){h=h.replace(new RegExp("(^|[^a-zA-Z0-9ÀÁÂÃÄÅÇÈÉÊËÌÍÎÏÒÓÔÕÖÙÚÛÜÝàáâãäåçèéêëìíîïðñòóôõöùúûüýÿ'`]|%)"+j[b]),"$1"+j[b].substring(0,1).toUpperCase()+j[b].substring(1).toLowerCase())}}}}}for(b=0;g&&g[b];b++){h=h.replace("%_%%"+b+"%%_%",g[b])}e.selection.setContent(h.replace(/^<[^>]*>/,"").replace(/<[^>]*>$/,""))},__buildGrid:function(d,e){var b=0;var c=[];a(["thead","tbody","tfoot"],function(f){var g=e.select(f+" tr",d);a(g,function(h,i){i+=b;a(e.select("td,th",h),function(o,j){var k,l,m,n;if(c[i]){while(c[i][j]){j++}}m=parseInt(o.getAttribute("rowspan")||1);n=parseInt(o.getAttribute("colspan")||1);for(l=i;l<i+m;l++){if(!c[l]){c[l]=[]}for(k=j;k<j+n;k++){c[l][k]={part:f,real:l==i&&k==j,elm:o,rowspan:m,colspan:n}}}})});b+=g.length});return c},_extractTableColumn:function(s){var q=this,m=q.editor,e,k,n=m.getDoc(),o=m.getBody();if(s==2){var c=q._checkColumnContent(q.editor);if(c.length==3&&c[1]==false){s=3}}s=s-1;var h=new RegExp("^(?:<[^>]*>|&nbsp;|\\s)*$");var p=m.dom.select("body > table, body > div > table");for(var j=0;j<p.length;j++){var f="";var r=m.dom.select("tbody > tr, thead > tr",p[j]);for(var g=0;g<r.length;g++){var l=m.dom.select("th, td",r[g]);if(l.length<s+1){alert(m.getLang("wetkitcleanup.not_exists_chosen_column"));return}if(m.dom.select("p, div, ul, ol",l[s]).length>0){f+=l[s].innerHTML}else{f+="<p>"+l[s].innerHTML+"</p>"}}m.dom.setOuterHTML(p[j],f)}},_checkColumnContent:function(h){var d=new RegExp("^(?:<[^>]*>|&nbsp;|\\s)*$");var b=Array();var i=h.dom.select("body > table, body > div > table");for(var f=0;f<i.length;f++){var j=h.dom.select("tbody > tr, thead > tr",i[f]);for(var e=0;e<j.length;e++){var g=h.dom.select("th, td",j[e]);for(var c=0;c<g.length;c++){if(!d.test(g[c].innerHTML)){b[c]=true}else{b[c]=b[c]?b[c]:false}}}}return b},_splitColumnContent:function(u,p){var l=this;var c=l.editor.id.indexOf("-en-")>-1?1:0;var e=tinyMCE.get(u[c]);var o=l._checkColumnContent(l.editor);var v=new RegExp("^(?:<[^>]*>|&nbsp;|\\s)*$");if(o.length==3&&o[1]==false){if(p[0]==1){p=Array(1,3)}else{p=Array(3,1)}}e.dom.setHTML(e.dom.getRoot(),l.editor.getContent());for(var m=0;m<2;m++){var n=p[m]-1;var g=tinyMCE.get(u[m]),q=g.getDoc(),s=g.getBody();var h=g.dom.select("body > table, body > div > table");for(var f=0;f<h.length;f++){var r="";var j=g.dom.select("tbody > tr, thead > tr",h[f]);for(var k=0;k<j.length;k++){var i=g.dom.select("th, td",j[k]);if(i.length<n+1){alert(g.getLang("wetkitcleanup.not_exists_chosen_column"));return}if(g.dom.select("p, div, ul, ol",i[n]).length>0){r+=i[n].innerHTML}else{r+="<p>"+i[n].innerHTML+"</p>"}}g.dom.setOuterHTML(h[f],r)}}},_addTableHeaders:function(z){var q=this,h=q.editor,e,r,u=h.getDoc(),w=h.getBody();var k=u.getElementsByTagName(z?"thead":"table");var A=new RegExp("^(?:<[^>]*>|&nbsp;|\\s)*$");for(var g=0;g<k.length;g++){var y=k[g];var m=y.getElementsByTagName("tr");for(var o=0;o<m.length;o++){var n=m[o].getElementsByTagName("td");var f=n?n.length:0;var s=0;for(var l=1;l<=f;l++){var n=m[o].getElementsByTagName("td");var j=n[s];if(j&&j.innerHTML.test(A)){f++;s++}else{if(j){var p=u.createElement("th");for(var v=0;v<j.childNodes.length;v++){p.appendChild(j.childNodes[v].cloneNode(1))}for(var x=0;x<j.attributes.length;x++){h.dom.setAttrib(p,j.attributes[x].name,h.dom.getAttrib(j,j.attributes[x].name))}h.dom.setAttrib(p,"scope",(h.dom.getAttrib(j,"colspan")>1?"colgroup":"col"));j.parentNode.replaceChild(p,j);j=p}}}if(!z){o=m.length}}}},_tableStripWidthHeight:function(e){var n=this,j=n.editor,c,h,k=j.getDoc(),l=j.getBody();var m=Array();if(e){m[0]=n._getSetActiveTableDom()}else{m=k.getElementsByTagName("table")}for(var g=0;m[g];g++){j.dom.setAttribs(m[g],{width:null,height:null});var o=m[g].getElementsByTagName("tr");for(var f=0;f<o.length;f++){j.dom.setAttribs(o[f],{width:null,height:null});j.dom.setAttribs(o[f].getElementsByTagName("td"),{width:null,height:null});j.dom.setAttribs(o[f].getElementsByTagName("th"),{width:null,height:null})}}},_numberGroups:function(){var h=this,f=h.editor,e,g,k=f.getDoc(),c=f.getBody();var j=new RegExp("(\\d+)\\s+(\\d{3})","ig");c.innerHTML=c.innerHTML.replace(j,"$1&nbsp;$2");c.innerHTML=c.innerHTML.replace(j,"$1&nbsp;$2");c.innerHTML=c.innerHTML.replace(j,"$1&nbsp;$2");var j=new RegExp("(\\d+)\\s+\\$","ig");c.innerHTML=c.innerHTML.replace(j,"$1&nbsp;$")},_tableDataAlign:function(n){var u=this,m=u.editor,c,k,o=m.getDoc(),q=m.getBody();var s=Array();s=o.getElementsByTagName("table");var g=new RegExp(/^\s*(?:<p[^>]*>)?((?:[\d,\.$%()-]|\s|<\/?(?:strong|em)>|&nbsp;)+)(?:<\/p>)?\s*$/i);for(var j=0;s[j];j++){var r=s[j];var v=r.getElementsByTagName("tr");for(var h=0;h<v.length;h++){var l=v[h].getElementsByTagName("td");var p=l?l.length:0;for(var f=0;f<p;f++){var e=l[f];if(l[f]&&g.test(l[f].innerHTML)){l[f].innerHTML=l[f].innerHTML.replace(g,"$1");m.dom.setStyle(l[f],"text-align",n)}}}}},_tableDataParas:function(){var q=this,l=q.editor,c,j,m=l.getDoc(),n=l.getBody();var o=Array();o=m.getElementsByTagName("table");for(var h=0;o[h];h++){var k=o[h].getElementsByTagName("td");for(var g=0;g<k.length;g++){var f=k[g];var e=f.getElementsByTagName("p");if(e.length==1){f.innerHTML=e[0].innerHTML}}}},_tableConvertAlignToStyles:function(){var p=this,k=p.editor,c,h,l=k.getDoc(),n=k.getBody();var o=Array();o=l.getElementsByTagName("table");for(var g=0;o[g];g++){var q=o[g].getElementsByTagName("tr");for(var f=0;f<q.length;f++){var j=q[f].getElementsByTagName("td");var m=j?j.length:0;for(var e=0;e<m;e++){if(j[e]&&k.dom.getAttrib(j[e],"valign")){k.dom.setStyle(j[e],"vertical-align",k.dom.getAttrib(j[e],"valign"))}if(j[e]&&k.dom.getAttrib(j[e],"align")){k.dom.setStyle(j[e],"text-align",k.dom.getAttrib(j[e],"align"))}k.dom.setAttribs(j[e],{valign:null,align:null})}var j=q[f].getElementsByTagName("th");var m=j?j.length:0;for(var e=0;e<m;e++){if(j[e]&&k.dom.getAttrib(j[e],"valign")){k.dom.setStyle(j[e],"vertical-align",k.dom.getAttrib(j[e],"valign"))}if(j[e]&&k.dom.getAttrib(j[e],"align")){k.dom.setStyle(j[e],"text-align",k.dom.getAttrib(j[e],"align"))}k.dom.setAttribs(j[e],{valign:null,align:null})}}}},_addTableRowHeaders:function(h){var p=this,g=p.editor,e,q,r=g.getDoc(),u=g.getBody();var k=Array();if(h){k[0]=p._getSetActiveTableDom()}else{k=r.getElementsByTagName("table")}var x=new RegExp("^(?:<[^>]*>|&nbsp;|\\s)*$");for(var f=0;k[f];f++){var w=k[f];var l=w.getElementsByTagName("tr");for(var n=0;n<l.length;n++){var m=l[n].getElementsByTagName("td");var j=m[0];if(j&&!j.innerHTML.test(x)){var o=r.createElement("th");for(var s=0;s<j.childNodes.length;s++){o.appendChild(j.childNodes[s].cloneNode(1))}for(var v=0;v<j.attributes.length;v++){g.dom.setAttrib(o,j.attributes[v].name,g.dom.getAttrib(j,j.attributes[v].name))}g.dom.setAttrib(o,"scope",(g.dom.getAttrib(j,"rowspan")>1?"rowgroup":"row"));j.parentNode.replaceChild(o,j);j=o}}}},_addTableCellIDHeaders:function(){var p=this,j=p.editor,f,w,z=j.getDoc(),A=j.getBody();var l=Array();var o=z.getElementsByTagName("table");if(!confirm("Apply to all tables [okay] or just this table [cancel]")){l[0]=p._getSetActiveTableDom()}else{l=z.getElementsByTagName("table")}var D=new RegExp("^(?:<[^>]*>|&nbsp;|\\s)*$");for(var h=0;l[h];h++){var B=l[h];var u=1;if(!B.id){for(tid=1000;z.getElementById("table-"+tid);tid++){}s="table-"+tid;B.id=s}var s=B.id;var q=[];var c=p.__buildGrid(B,j.dom);for(var m=0;m<c.length;m++){for(var n=0;n<c[m].length;n++){if(!D.test(c[m][n].elm.innerHTML)){if(c[m][n].real&&c[m][n].elm.tagName.toLowerCase()=="th"){c[m][n].elm.id=s+"-r"+(m+1)+"-c"+(n+1);if(!q[m]){q[m]=[]}for(var r=n;r<n+c[m][n].colspan;r++){for(var v=m;v<m+c[m][n].rowspan;v++){if(!q[v]){q[v]=[]}if(!q[v][r]){q[v][r]={id:c[m][n].elm.id,section:j.dom.getParent(c[m][n].elm,"thead,tfoot,tbody").nodeName.toLowerCase(),scope:j.dom.getAttrib(c[m][n].elm,"scope")}}}}j.dom.setAttrib(c[m][n].elm,"headers",null);u++}else{if(c[m][n].real){var e=[];var g=null;for(var C=0;C<q.length;C++){if(q[C]&&q[C][n]&&q[C][n].id&&e.indexOf(q[C][n].id)==-1&&(q[C][n].scope=="col"||q[C][n].scope=="colgroup")){if(q[C][n].scope=="colgroup"&&q[C][n].section=="tbody"){g=q[C][n].id}else{e[e.length]=q[C][n].id}}}if(g!=null){e[e.length]=g}for(var k=0;q[m]&&k<q[m].length;k++){if(q[m][k]&&q[m][k].id&&e.indexOf(q[m][k].id)==-1&&(q[m][k].scope=="row"||q[m][k].scope=="rowgroup")){e[e.length]=q[m][k].id}}j.dom.setAttrib(c[m][n].elm,"headers",e.join(" "))}}}}}}},_getSetActiveTableDom:function(){var d=this;var c=d.editor.selection.getNode();var b=d.editor.dom.getParent(c,"table");if(!b){alert(d.editor.getLang("wetkitcleanup.no_table_selected"));return null}d.editor.selection.select(b);return b},_tableToText:function(){var j=this,g=j.editor,f,h,l=g.getDoc(),c=g.getBody();var e=j._getSetActiveTableDom();var k=new RegExp("</*(?:thead|tbody|tfoot|td|th|tr|table|caption)[^>]*>","ig");g.selection.setContent(g.selection.getContent().replace(k,""))},_stripAllTables:function(){var h=this,f=h.editor,e,g,k=f.getDoc(),c=f.getBody();var j=new RegExp("</*(?:thead|tbody|tfoot|td|th|tr|table|caption)[^>]*>","ig");c.innerHTML=c.innerHTML.replace(j,"")},_findReplaceAcronyms:function(k){var l=this,d=l.editor,B=d.selection,n=B.getRng(),y,m,g,A,h=0,j=d.getWin(),c=d.windowManager,e=0;if(k){d.focus();d.windowManager.open({file:l.url+"/acronym.htm",width:420+parseInt(d.getLang("wetkitcleanup.delta_width",0)),height:170+parseInt(d.getLang("wetkitcleanup.delta_height",0)),inline:1,auto_focus:0},{plugin_url:l.url});return}var C=d.getParam("content_language");if(k){var q=prompt("Exact term to find","");var u=prompt("Full description of term to insert","");var p=confirm("Use ABBR tag instead of ACRONYM for replacements? Use Cancel for No.");tinyAcronymUseList=[{abbr:p,en:[q,u],fr:[q,u]}]}else{tinyAcronymUseList=tinyAcronymList}if(tinyAcronymList==null){alert("No Acronyms to process!");return}if(tinymce.isIE){d.focus();if(l.acronymRunCount==0){alert("If this doesn't run, it's probably due to a bug in IE. Try running this again.")}l.acronymRunCount=1;n=d.getDoc().selection.createRange()}function o(){n=B.getRng().cloneRange();d.getDoc().execCommand("SelectAll",false,null);B.setRng(n)}function z(r,b,i){if(!confirm("Add "+(i?"abbr":"acronym")+' tag for "'+b+'"?')){if(tinymce.isIE){d.selection.getRng().duplicate().pasteHTML(r)}return}b=i?'<abbr title="'+b+'">'+r+"</abbr>":'<acronym title="'+b+'">'+r+"</acronym>";if(tinymce.isIE){d.selection.getRng().duplicate().pasteHTML(b)}else{d.selection.setContent(b)}}if(tinymce.isIE){n=d.getDoc().selection.createRange()}var A=null;var h=4;for(var x=0;tinyAcronymUseList[x];x++){d.execCommand("SelectAll");d.selection.collapse(true);var v=tinyAcronymUseList[x].en;if(C=="fr"){v=tinyAcronymUseList[x].fr}m=v[0];g=v[1];if(tinymce.isIE){while(n.findText(m,1,h)){n.scrollIntoView();n.select();z(m,g,tinyAcronymUseList[x].abbr);e=1;if(A){n.moveEnd("character",-(g.length))}}}else{while(j.find(m,true,A,false,false,false,false)){z(m,g,tinyAcronymUseList[x].abbr);e=1}}}},_convertExtended:function(d){var c=this,b;if(!c.extendedChars){c.extendedChars=Array(" ","&nbsp;","&","&amp;","À","&Agrave;","Á","&Aacute;","Â","&Acirc;","Ã","&Atilde;","Ä","&Auml;","Å","&Aring;","Ç","&Ccedil;","È","&Egrave;","É","&Eacute;","Ê","&Ecirc;","Ë","&Euml;","Ì","&Igrave;","Í","&Iacute;","Î","&Icirc;","Ï","&Iuml;","Ò","&Ograve;","Ó","&Oacute;","Ô","&Ocirc;","Õ","&Otilde;","Ö","&Ouml;","Ù","&Ugrave;","Ú","&Uacute;","Û","&Ucirc;","Ü","&Uuml;","Ý","&Yacute;","à","&agrave;","á","&aacute;","â","&acirc;","ã","&atilde;","ä","&auml;","å","&aring;","ç","&ccedil;","è","&egrave;","é","&eacute;","ê","&ecirc;","ë","&euml;","ì","&igrave;","í","&iacute;","î","&icirc;","ï","&iuml;","ð","&eth;","ñ","&ntilde;","ò","&ograve;","ó","&oacute;","ô","&ocirc;","õ","&otilde;","ö","&ouml;","ù","&ugrave;","ú","&uacute;","û","&ucirc;","ü","&uuml;","ý","&yacute;","ÿ","&yuml;")}for(b=0;c.extendedChars[b];b+=2){d=d.replace(new RegExp(c.extendedChars[b+1],"g"),c.extendedChars[b])}return d}});tinymce.PluginManager.add("wetkitcleanup",tinymce.plugins.WAS_Cleanup)})();